<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kotlin ❤ FP</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link rel='stylesheet' href='./styles.css'>
  <link href='https://fonts.googleapis.com/css?family=Anonymous+Pro:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="layout" class="layout">
  <header class="article-nav">
    <button class="menu-link">
      <!-- Hamburger icon -->
      <span></span>
    </button>
    <div class="article-nav-links">
      <a href="Quasar-Efficient-and-Elegant-Fibers-Channels-and-Actors.html" class="article-nav-link article-nav-link--prev">previous</a>
      <a href="Production-Ready-Kotlin.html" class="article-nav-link article-nav-link--next">next</a>
    </div>
  </header>

  <aside id="menu" class="menu">
    <div class="pure-menu">
      <ul class="pure-menu-list">
        <li class="pure-menu-list-date">Jun 06, 2016</li><li><a href="./When-Kotlin-met-Gradle.html">When Kotlin met Gradle</a></li>
<li class="pure-menu-list-date">Jun 03, 2016</li><li><a href="./Kotlin-Eclipse-Plugin-0-7-Is-Here.html">Kotlin Eclipse Plugin 0.7 Is Here!</a></li>
<li class="pure-menu-list-date">Jun 01, 2016</li><li><a href="./Where-We-Stand-What-s-Next-for-Kotlin.html">Where We Stand & What's Next for Kotlin</a></li>
<li class="pure-menu-list-date">May 20, 2016</li><li><a href="./Kotlin-dragging-java-into-the-modern-world.html">Kotlin, dragging java into the modern world</a></li>
<li class="pure-menu-list-date">May 18, 2016</li><li><a href="./Gradle-Meets-Kotlin.html">Gradle Meets Kotlin</a></li>
<li><a href="./Kotlin-Meets-Gradle.html">Kotlin Meets Gradle</a></li>
<li class="pure-menu-list-date">May 17, 2016</li><li><a href="./Gradle-Elevates-the-Build-to-First-Class-Programming-With-Kotlin-Language.html">Gradle Elevates the Build to First-Class Programming With Kotlin Language</a></li>
<li class="pure-menu-list-date">May 13, 2016</li><li><a href="./Kotlin-1-0-2-is-Here.html">Kotlin 1.0.2 is Here</a></li>
<li class="pure-menu-list-date">May 12, 2016</li><li><a href="./Kosent.html">Kosent</a></li>
<li class="pure-menu-list-date">May 10, 2016</li><li><a href="./Testing-in-Kotlin.html">Testing in Kotlin</a></li>
<li class="pure-menu-list-date">May 01, 2016</li><li><a href="./JMock-and-Kotlin.html">JMock and Kotlin</a></li>
<li class="pure-menu-list-date">Apr 29, 2016</li><li><a href="./Exercises-in-Kotlin-Part-5-Classes.html">Exercises in Kotlin: Part 5 - Classes</a></li>
<li class="pure-menu-list-date">Apr 27, 2016</li><li><a href="./Exercises-in-Kotlin-Part-4-Control-flows-and-return.html">Exercises in Kotlin: Part 4 - Control flows and return</a></li>
<li class="pure-menu-list-date">Apr 24, 2016</li><li><a href="./Writing-Concise-Code-With-Kotlin.html">Writing Concise Code With Kotlin</a></li>
<li><a href="./Type-safe-JavaFX-CSS-with-TornadoFX.html">Type safe JavaFX CSS with TornadoFX</a></li>
<li class="pure-menu-list-date">Apr 21, 2016</li><li><a href="./JDK7-8-features-in-Kotlin-1-0.html">JDK7/8 features in Kotlin 1.0</a></li>
<li class="pure-menu-list-date">Apr 20, 2016</li><li><a href="./Exercises-in-Kotlin-Part-3-Functions.html">Exercises in Kotlin: Part 3 - Functions</a></li>
<li><a href="./Kotlin-Android-First-Impressions.html">Kotlin + Android First Impressions</a></li>
<li class="pure-menu-list-date">Apr 19, 2016</li><li><a href="./Exercises-in-Kotlin-Part-2-High-level-syntax-and-Variables.html">Exercises in Kotlin: Part 2 - High level syntax and Variables</a></li>
<li class="pure-menu-list-date">Apr 18, 2016</li><li><a href="./Exercises-in-Kotlin-Part-1-Getting-Started.html">Exercises in Kotlin: Part 1 - Getting Started</a></li>
<li class="pure-menu-list-date">Apr 17, 2016</li><li><a href="./Code-improvements-with-Kotlin.html">Code improvements with Kotlin</a></li>
<li class="pure-menu-list-date">Apr 15, 2016</li><li><a href="./Few-thoughts-about-Kotlin-and-why-I-like-it-so-much.html">Few thoughts about Kotlin and why I like it so much</a></li>
<li class="pure-menu-list-date">Apr 14, 2016</li><li><a href="./Kotlin-for-Scala-Developers.html">Kotlin for Scala Developers</a></li>
<li><a href="./Kotlin-Post-1-0-Roadmap.html">Kotlin Post-1.0 Roadmap</a></li>
<li class="pure-menu-list-date">Apr 11, 2016</li><li><a href="./Making-Android-Development-Easier.html">Making Android Development Easier</a></li>
<li class="pure-menu-list-date">Apr 09, 2016</li><li><a href="./Keddit — Part-7-Infinite-Scroll-Higher-Order-functions-Lambdas.html">Keddit — Part 7: Infinite Scroll: Higher-Order functions & Lambdas</a></li>
<li><a href="./The-Kobalt-diaries-Automatic-Android-SDK-management.html">The Kobalt diaries: Automatic Android SDK management</a></li>
<li class="pure-menu-list-date">Apr 07, 2016</li><li><a href="./Android-And-Kotlin.html">Android And Kotlin</a></li>
<li class="pure-menu-list-date">Apr 06, 2016</li><li><a href="./Kotlin-Digest-2016-Q1.html">Kotlin Digest 2016.Q1</a></li>
<li><a href="./Kotlin-DSL-Anko.html">Kotlin DSL: Anko</a></li>
<li class="pure-menu-list-date">Apr 04, 2016</li><li><a href="./Kotlin-Practical-Experience.html">Kotlin: Practical Experience</a></li>
<li><a href="./Kotlin’s-killer-features.html">Kotlin’s killer features</a></li>
<li><a href="./Exploring-Delegation-in-Kotlin.html">Exploring Delegation in Kotlin</a></li>
<li class="pure-menu-list-date">Apr 03, 2016</li><li><a href="./Experimental-Kotlin-and-mutation-testing.html">Experimental: Kotlin and mutation testing</a></li>
<li class="pure-menu-list-date">Mar 31, 2016</li><li><a href="./10-Features-I-Wish-Java-Would-Steal-From-the-Kotlin-Language.html">10 Features I Wish Java Would Steal From the Kotlin Language</a></li>
<li class="pure-menu-list-date">Mar 30, 2016</li><li><a href="./Ubuntu-Make-16-03-Released-With-Eclipse-JEE-And-IntelliJ-IDEA-EAP-Support-More.html">Ubuntu Make 16.03 Released With Eclipse JEE And IntelliJ IDEA EAP Support, More</a></li>
<li><a href="./Kotlin’s-Android-Roadmap.html">Kotlin’s Android Roadmap</a></li>
<li class="pure-menu-list-date">Mar 29, 2016</li><li><a href="./Rest-API-plumbing-with-kotlin.html">Rest API plumbing with kotlin</a></li>
<li class="pure-menu-list-date">Mar 28, 2016</li><li><a href="./Creating-an-AndroidWear-watchface-using-Kotlin.html">Creating an AndroidWear watchface using Kotlin</a></li>
<li class="pure-menu-list-date">Mar 22, 2016</li><li><a href="./Writing-a-RESTful-backend-using-Kotlin-and-Spring-Boot.html">Writing a RESTful backend using Kotlin and Spring Boot</a></li>
<li><a href="./How-to-Hot-Deploy-Java-Kotlin-classes-in-Dev.html">How to Hot Deploy Java/Kotlin classes in Dev</a></li>
<li><a href="./RU-Андрей-Бреслав-и-Дмитрий-Жемеров-о-Kotlin-1-0-на-jug-msk-ru.html">(RU) Андрей Бреслав и Дмитрий Жемеров о Kotlin 1.0 на jug.msk.ru</a></li>
<li class="pure-menu-list-date">Mar 20, 2016</li><li><a href="./A-Geospatial-Messenger-with-Kotlin-Spring-Boot-and-PostgreSQL.html">A Geospatial Messenger with Kotlin, Spring Boot and PostgreSQL</a></li>
<li class="pure-menu-list-date">Mar 19, 2016</li><li><a href="./Algebraic-Data-Types-In-Kotlin.html">Algebraic Data Types In Kotlin</a></li>
<li><a href="./Kotlin-Month-Post-4-Properties.html">Kotlin Month Post 4: Properties</a></li>
<li class="pure-menu-list-date">Mar 17, 2016</li><li><a href="./Kotlin-Educational-Plugin.html">Kotlin Educational Plugin</a></li>
<li class="pure-menu-list-date">Mar 16, 2016</li><li><a href="./Using-Kotlin-For-Tests-in-Android.html">Using Kotlin For Tests in Android</a></li>
<li><a href="./Kotlin-1-0-1-is-Here.html">Kotlin 1.0.1 is Here!</a></li>
<li><a href="./Kotlin-recipes-for-Android-I-OnGlobalLayoutListener.html">Kotlin recipes for Android (I): OnGlobalLayoutListener</a></li>
<li class="pure-menu-list-date">Mar 15, 2016</li><li><a href="./Kotlin-Retrofit-RxAndroid-Realm.html">Kotlin : Retrofit + RxAndroid + Realm</a></li>
<li class="pure-menu-list-date">Mar 14, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Wrap-Up.html">Kotlin & Android: A Brass Tacks Experiment Wrap-Up</a></li>
<li class="pure-menu-list-date">Mar 13, 2016</li><li><a href="./Kotlin-Month-Post-3-Safety.html">Kotlin Month Post 3: Safety</a></li>
<li><a href="./Feedback-on-the-Josephus-problem.html">Feedback on the Josephus problem</a></li>
<li class="pure-menu-list-date">Mar 11, 2016</li><li><a href="./RU-SDCast-41-в-гостях-Андрей-Бреслав-руководитель-проекта-Kotlin-в-компании-JetBrains.html">(RU) SDCast #41: в гостях Андрей Бреслав, руководитель проекта Kotlin в компании JetBrains</a></li>
<li><a href="./Why-I-don-t-want-to-use-Kotlin-for-Android-Development-yet.html">Why I don't want to use Kotlin for Android Development yet</a></li>
<li class="pure-menu-list-date">Mar 09, 2016</li><li><a href="./Getting-Started-with-Kotlin-and-Anko-on-Android.html">Getting Started with Kotlin and Anko on Android</a></li>
<li><a href="./RU-Дмитрий-Полищук-Kotlin-Android-практический-ликбез.html">(RU) Дмитрий Полищук - Kotlin + Android: практический ликбез</a></li>
<li class="pure-menu-list-date">Mar 08, 2016</li><li><a href="./A-DSL-Workbench-with-Gradle-and-Kotlin.html">A DSL Workbench with Gradle and Kotlin</a></li>
<li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-6.html">Kotlin & Android: A Brass Tacks Experiment, Part 6</a></li>
<li class="pure-menu-list-date">Mar 06, 2016</li><li><a href="./Solving-the-Josephus-problem-in-Kotlin.html">Solving the Josephus problem in Kotlin</a></li>
<li class="pure-menu-list-date">Mar 05, 2016</li><li><a href="./Kotlin-Month-Post-2-Inheritance-and-Defaults.html">Kotlin Month Post 2: Inheritance and Defaults</a></li>
<li class="pure-menu-list-date">Mar 04, 2016</li><li><a href="./Building-a-Kotlin-project-2-2.html">Building a Kotlin project 2/2</a></li>
<li><a href="./Building-a-Kotlin-project-1-2.html">Building a Kotlin project 1/2</a></li>
<li><a href="./RU-Видео-со-встречи-JUG-ru-с-разработчиками-Kotlin.html">(RU) Видео со встречи JUG.ru с разработчиками Kotlin</a></li>
<li class="pure-menu-list-date">Mar 03, 2016</li><li><a href="./Kotlin-a-new-JVM-language-you-should-try.html">Kotlin: a new JVM language you should try</a></li>
<li class="pure-menu-list-date">Mar 02, 2016</li><li><a href="./RU-Kotlin-для-начинающих.html">(RU) Kotlin для начинающих</a></li>
<li class="pure-menu-list-date">Mar 01, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-5.html">Kotlin & Android: A Brass Tacks Experiment, Part 5</a></li>
<li><a href="./Developing-on-Android-sucks-a-lot-less-with-Kotlin.html">Developing on Android sucks a lot less with Kotlin</a></li>
<li class="pure-menu-list-date">Feb 29, 2016</li><li><a href="./The-Journey-of-a-Spring-Boot-application-from-Java-8-to-Kotlin-part-3-Data-Classes.html">The Journey of a Spring Boot application from Java 8 to Kotlin, part 3: Data Classes</a></li>
<li><a href="./Как-себе-выстрелить-в-ногу-в-Kotlin.html">Как себе выстрелить в ногу в Kotlin</a></li>
<li class="pure-menu-list-date">Feb 28, 2016</li><li><a href="./Kotlin-and-Ceylon.html">Kotlin and Ceylon</a></li>
<li class="pure-menu-list-date">Feb 27, 2016</li><li><a href="./Kotlin-Month-Post-1-Assorted-Features.html">Kotlin Month Post 1: Assorted Features</a></li>
<li class="pure-menu-list-date">Feb 24, 2016</li><li><a href="./Kotlin-2-Years-On.html">Kotlin - 2 Years On</a></li>
<li class="pure-menu-list-date">Feb 23, 2016</li><li><a href="./The-Journey-of-a-Spring-Boot-application-from-Java-8-to-Kotlin-part-2-Configuration-Classes.html">The Journey of a Spring Boot application from Java 8 to Kotlin, part 2: Configuration Classes</a></li>
<li><a href="./An-Introduction-to-Kotlin.html">An Introduction to Kotlin</a></li>
<li><a href="./Kotlin-1-0-is-finally-released.html">Kotlin 1.0 is finally released!</a></li>
<li class="pure-menu-list-date">Feb 22, 2016</li><li><a href="./More-Kotlin-Features-to-Love.html">More Kotlin Features to Love</a></li>
<li><a href="./A-Very-Peculiar-but-Possibly-Cunning-Kotlin-Language-Feature.html">A Very Peculiar, but Possibly Cunning Kotlin Language Feature.</a></li>
<li><a href="./Kotlin-Easily-storing-a-list-in-SharedPreferences-with-Custom-Accessors.html">Kotlin: Easily storing a list in SharedPreferences with Custom Accessors</a></li>
<li class="pure-menu-list-date">Feb 21, 2016</li><li><a href="./Kotlin — Love-at-first-line.html">Kotlin — Love at first line</a></li>
<li class="pure-menu-list-date">Feb 20, 2016</li><li><a href="./RU-Радио-Т-484.html">(RU) Радио-Т 484</a></li>
<li><a href="./RU-DevZen-Podcast-Kotlin-и-Vulkan-1-0-—-Episode-0080.html">(RU) DevZen Podcast: Kotlin и Vulkan 1.0 — Episode 0080.</a></li>
<li><a href="./The-Kobalt-diaries-testing.html">The Kobalt diaries: testing</a></li>
<li><a href="./RU-Немного-о-Kotlin.html">(RU) Немного о Kotlin.</a></li>
<li><a href="./Using-Mockito-for-unit-testing-with-Kotlin-1-x.html">Using Mockito for unit testing with Kotlin (1/x)</a></li>
<li><a href="./Weekend-resources-for-new-Kotlin-programmers.html">Weekend resources for new Kotlin programmers</a></li>
<li class="pure-menu-list-date">Feb 19, 2016</li><li><a href="./RU-Kotlin-1-0-Задай-вопрос-команде.html">(RU) Kotlin 1.0. Задай вопрос команде.</a></li>
<li class="pure-menu-list-date">Feb 16, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-3.html">Kotlin & Android: A Brass Tacks Experiment, Part 3.</a></li>
<li><a href="./Kotlin-1-0-The-good-the-bad-and-the-evident.html">Kotlin 1.0: The good, the bad and the evident.</a></li>
<li><a href="./RU-Релиз-Kotlin-1-0-языка-программирования-для-JVM-и-Android.html">(RU) Релиз Kotlin 1.0, языка программирования для JVM и Android.</a></li>
<li class="pure-menu-list-date">Feb 15, 2016</li><li><a href="./JVM-Newcomer-Kotlin-1-0-is-GA.html">JVM Newcomer Kotlin 1.0 is GA</a></li>
<li><a href="./Developing-Spring-Boot-applications-with-Kotlin.html">Developing Spring Boot applications with Kotlin.</a></li>
<li><a href="./Kotlin-1-0-Released-Pragmatic-Language-for-JVM-and-Android.html">Kotlin 1.0 Released: Pragmatic Language for JVM and Android</a></li>
<li class="pure-menu-list-date">Feb 13, 2016</li><li><a href="./The-Journey-of-a-Spring-Boot-application-from-Java-8-to-Kotlin-The-Application-Class.html">The Journey of a Spring Boot application from Java 8 to Kotlin: The Application Class</a></li>
<li class="pure-menu-list-date">Feb 04, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-4.html">Kotlin & Android: A Brass Tacks Experiment, Part 4</a></li>
<li><a href="./RU-Podcast-Разбор-Полетов-Episode-102-—-Kotlin-тесты-и-здоровый-сон.html">(RU) Podcast Разбор Полетов: Episode 102 — Kotlin, тесты и здоровый сон.</a></li>
<li><a href="./Kotlin-1-0-Release-Candidate-is-Out.html">Kotlin 1.0 Release Candidate is Out!</a></li>
<li class="pure-menu-list-date">Feb 03, 2016</li><li><a href="./Kotlin-Coding.html">Kotlin Coding</a></li>
<li class="pure-menu-list-date">Feb 02, 2016</li><li><a href="./10-Kotlin-Tutorials-for-Beginners-Dive-Into-Kotlin-Programming.html">10 Kotlin Tutorials for Beginners: Dive Into Kotlin Programming</a></li>
<li class="pure-menu-list-date">Feb 01, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-2.html">Kotlin & Android: A Brass Tacks Experiment, Part 2.</a></li>
<li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-1.html">Kotlin & Android: A Brass Tacks Experiment, Part 1.</a></li>
<li class="pure-menu-list-date">Jan 25, 2016</li><li><a href="./KillerTask-the-solution-to-AsyncTask-implementation.html">KillerTask, the solution to AsyncTask implementation</a></li>
<li class="pure-menu-list-date">Jan 23, 2016</li><li><a href="./My-Kotlin-Adventure.html">My Kotlin Adventure</a></li>
<li class="pure-menu-list-date">Jan 16, 2016</li><li><a href="./Mimicking-Kotlin-Builders-in-Java-and-Python.html">Mimicking Kotlin Builders in Java and Python</a></li>
<li class="pure-menu-list-date">Jan 15, 2016</li><li><a href="./Android-development-with-Kotlin.html">Android development with Kotlin</a></li>
<li><a href="./Kotlin-the-somewhat-obscure-modern-Android-friendly-programming-language.html">Kotlin, the somewhat obscure modern Android-friendly programming language</a></li>
<li class="pure-menu-list-date">Jan 14, 2016</li><li><a href="./Fun-with-Kotlin.html">Fun with Kotlin</a></li>
<li class="pure-menu-list-date">Jan 10, 2016</li><li><a href="./Playing-with-Spring-Boot-Vaadin-and-Kotlin.html">Playing with Spring Boot, Vaadin and Kotlin</a></li>
<li class="pure-menu-list-date">Jan 06, 2016</li><li><a href="./Kotlin-XML-Binding.html">Kotlin XML Binding</a></li>
<li class="pure-menu-list-date">Dec 30, 2015</li><li><a href="./Early-Impressions-of-Kotlin.html">Early Impressions of Kotlin</a></li>
<li class="pure-menu-list-date">Dec 12, 2015</li><li><a href="./Kotlin-for-Java-Developers-10-Features-You-Will-Love-About-Kotlin.html">Kotlin for Java Developers: 10 Features You Will Love About Kotlin</a></li>
<li class="pure-menu-list-date">Nov 11, 2015</li><li><a href="./Setting-up-Kotlin-with-Android-and-tests.html">Setting up Kotlin with Android and tests</a></li>
<li class="pure-menu-list-date">Nov 05, 2015</li><li><a href="./Functional-Programming-with-Kotlin.html">Functional Programming with Kotlin</a></li>
<li class="pure-menu-list-date">Oct 30, 2015</li><li><a href="./Exploring-the-Kotlin-standard-library.html">Exploring the Kotlin standard library</a></li>
<li class="pure-menu-list-date">Oct 22, 2015</li><li><a href="./Kotlin-NoSQL-for-MongoDB-in-Action.html">Kotlin NoSQL for MongoDB in Action</a></li>
<li class="pure-menu-list-date">Sep 21, 2015</li><li><a href="./Quasar-Efficient-and-Elegant-Fibers-Channels-and-Actors.html">Quasar: Efficient and Elegant Fibers, Channels and Actors</a></li>
<li class="pure-menu-list-date">Sep 18, 2015</li><li><a href="./Kotlin-❤-FP.html">Kotlin ❤ FP</a></li>
<li class="pure-menu-list-date">Aug 26, 2015</li><li><a href="./Production-Ready-Kotlin.html">Production Ready Kotlin</a></li>
<li class="pure-menu-list-date">Aug 12, 2015</li><li><a href="./JVMLS-2015-Flexible-Types-in-Kotlin.html">JVMLS 2015 - Flexible Types in Kotlin</a></li>
<li class="pure-menu-list-date">Aug 06, 2015</li><li><a href="./Building-APIs-on-the-JVM-Using-Kotlin-and-Spark-–-Part-1.html">Building APIs on the JVM Using Kotlin and Spark – Part 1</a></li>
<li class="pure-menu-list-date">Jul 31, 2015</li><li><a href="./RU-Без-слайдов-интервью-с-Дмитрием-Жемеровым-из-JetBrains.html">(RU) Без слайдов: интервью с Дмитрием Жемеровым из JetBrains</a></li>
<li class="pure-menu-list-date">Jul 20, 2015</li><li><a href="./Android-Kotlin-3.html">Android + Kotlin = <3</a></li>
<li class="pure-menu-list-date">Jul 06, 2015</li><li><a href="./Why-Kotlin-is-my-next-programming-language.html">Why Kotlin is my next programming language</a></li>
<li class="pure-menu-list-date">Jun 27, 2015</li><li><a href="./Exploring-Kotlin.html">Exploring Kotlin</a></li>
<li><a href="./RxAndroid-and-Kotlin-Part-1.html">RxAndroid and Kotlin (Part 1)</a></li>
<li class="pure-menu-list-date">Jun 04, 2015</li><li><a href="./Quasar-and-Kotlin-a-Powerful-Match.html">Quasar and Kotlin - a Powerful Match</a></li>
<li class="pure-menu-list-date">May 09, 2015</li><li><a href="./Kotlin-New-Hope-in-a-Java-6-Wasteland.html">Kotlin: New Hope in a Java 6 Wasteland</a></li>
<li class="pure-menu-list-date">Dec 11, 2014</li><li><a href="./Kotlin-for-Java-developers.html">Kotlin for Java developers</a></li>
<li class="pure-menu-list-date">Dec 01, 2014</li><li><a href="./Non-trivial-constructors-in-Kotlin.html">Non-trivial constructors in Kotlin</a></li>
<li class="pure-menu-list-date">Nov 03, 2014</li><li><a href="./GeeCON-Prague-2014-Andrey-Cheptsov-A-Reactive-and-Type-safe-Kotlin-DSL-for-NoSQL-and-SQL.html">GeeCON Prague 2014: Andrey Cheptsov - A Reactive and Type-safe Kotlin DSL for NoSQL and SQL</a></li>
<li class="pure-menu-list-date">Sep 10, 2014</li><li><a href="./Kotlin-vs-Java-puzzlers.html">Kotlin vs Java puzzlers</a></li>
<li class="pure-menu-list-date">Apr 02, 2013</li><li><a href="./The-Advent-of-Kotlin-A-Conversation-with-JetBrains-Andrey-Breslav.html">The Advent of Kotlin: A Conversation with JetBrains' Andrey Breslav</a></li>
<li class="pure-menu-list-date">Feb 07, 2013</li><li><a href="./Exploring-the-Kotlin-Standard-Library-Part-3.html">Exploring the Kotlin Standard Library - Part 3</a></li>
<li class="pure-menu-list-date">Jan 25, 2013</li><li><a href="./Exploring-the-Kotlin-Standard-Library-Part-2.html">Exploring the Kotlin Standard Library - Part 2</a></li>
<li class="pure-menu-list-date">Jan 23, 2013</li><li><a href="./The-Adventurous-Developer’s-Guide-to-JVM-languages-–-Kotlin.html">The Adventurous Developer’s Guide to JVM languages – Kotlin</a></li>
<li class="pure-menu-list-date">Jan 22, 2013</li><li><a href="./Exploring-the-Kotlin-Standard-Library-Part-1.html">Exploring the Kotlin Standard Library - Part 1</a></li>
      </ul>
    </div>
  </aside>

  <section id="main" class="main">
    <div class="main-content">
      <h1>
        <a href="https://medium.com/@octskyward/kotlin-fp-3bf63a17d64a">Kotlin ❤ FP</a> - <span class="main-title-date">Sep 18, 2015</span>
      </h1>
      <h2>by Mike Hearn</h2>
      <h4>Functional programming in Kotlin, a new language from JetBrains</h4>
<p>I did <a href="http://blog.jetbrains.com/kotlin/2015/11/webinar-recording-functional-programming-with-kotlin/">a video tutorial on FP in Kotlin</a>, which can be viewed online.</p>
<p>If you use .NET you probably heard about F#, a multi-paradigm but essentially functional programming language for the CLR. And you probably heard good things about it. You may also have heard of Haskell, which is similar.</p>
<p>Perhaps you would like languages such as these on the JVM, but with great tool support and without <em>mandating</em> a functional style ... just making it available when you want it.</p>
<p><a href="http://kotlinlang.org/"><strong>The Kotlin language</strong></a> may at first glance appear to be nothing more than an upgraded Java: lots of syntax conveniences, some type inference and so on. But dig a little deeper and you will discover that many of the most popular and advanced features of functional languages are available.</p>
<p>Let&rsquo;s get started with some simple examples.</p>
<hr>
<h3>Algebraic data types</h3>
<p>It&rsquo;s normal for functional languages to support syntax like this:</p>
<pre><code class="hljs language-haskell"><span class="hljs-class"><span class="hljs-keyword">data</span>  <span class="hljs-type">Maybe</span> a  =  <span class="hljs-type">Nothing</span> | <span class="hljs-type">Just</span> a</span>
  <span class="hljs-keyword">deriving</span> (<span class="hljs-type">Eq</span>, <span class="hljs-type">Ord</span>)</code></pre>
<p>That&rsquo;s Haskell, and it defines a type called &ldquo;Maybe&rdquo; that has two so called <em>type constructors</em>, Nothing and Just. The Just type constructor takes a single parameter of unspecified type. The deriving keyword here means a Maybe can be compared for equality, and ordered. It can also be called a <em>tagged union</em>.</p>
<p>Kotlin doesn&rsquo;t need a Maybe type because it has optionality as a built in part of the type system. Optionality is so common in programs that it makes sense to integrate it at a deep level, for both convenience and performance reasons:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> s: String? = <span class="hljs-keyword">if</span> (Math.random() &lt; <span class="hljs-number">0.5</span>) <span class="hljs-string">"Yay!"</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span>
println(<span class="hljs-string">"length of string is .... <span class="hljs-subst">${s.length()}</span>"</span>)</code></pre>
<p>Here, we get a compile error on the second line, because we&rsquo;re trying to read the length of a string we might not actually have, depending on a coin flip. There&rsquo;s a simple fix:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> s: String? = <span class="hljs-keyword">if</span> (Math.random() &lt; <span class="hljs-number">0.5</span>) <span class="hljs-string">"Yay!"</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span>
println(<span class="hljs-string">"length of string is .... <span class="hljs-subst">${s?.length() ?: <span class="hljs-number">-1</span>}</span>"</span>)</code></pre>
<p>Here, s?.length() will yield null if s was null, and the ?: operator uses the right hand side if the left hand side is null. So this prints -1 if the coin flip didn&rsquo;t yield the string.</p>
<p>However, we won&rsquo;t think about that more here.</p>
<p>Because the Maybe type is so familiar to functional programmers, let&rsquo;s define an equivalent of it here just for illustration.</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Maybe</span>&lt;<span class="hljs-type">out T</span>&gt; </span>{
    <span class="hljs-keyword">object</span> None : Maybe&lt;<span class="hljs-built_in">Nothing</span>&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Just</span>&lt;<span class="hljs-type">T</span>&gt;</span>(<span class="hljs-keyword">val</span> t: T) : Maybe&lt;T&gt;()
}</code></pre>
<p>The syntax isn&rsquo;t as terse as Haskell, but isn&rsquo;t bad either. The data modifier here is optional, but adding it gives us useful features.</p>
<p>We can do a variety of functional things with this:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> j = Maybe.Just(<span class="hljs-number">1</span>)
<span class="hljs-keyword">val</span> (i) = j</code></pre>
<p>Here, we define a &ldquo;just&rdquo; containing an integer, and then we destructure it to get the integer back. Notice the lack of types: it&rsquo;s all inferred. If the type had defined multiple fields, we could <a href="http://kotlinlang.org/docs/reference/multi-declarations.html">destructure all of them</a>, which is how this is actually meant to be used:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pet</span></span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>)
<span class="hljs-keyword">val</span> alice = Pet(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">6</span>)
<span class="hljs-keyword">val</span> (name, age) = alice</code></pre>
<p>What about pattern matching? This is where the word &ldquo;sealed&rdquo; above comes in handy; we can do an exhaustive pattern match without an else/otherwise branch:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>(<span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">lookupFromDB</span><span class="hljs-params">(s: <span class="hljs-type">String</span>)</span></span>: Maybe&lt;User&gt; = Maybe.None

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printUser</span><span class="hljs-params">(username: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> rec = lookupFromDB(username)
    <span class="hljs-keyword">when</span> (rec) {
        <span class="hljs-keyword">is</span> Maybe.None -&gt; println(<span class="hljs-string">"not found"</span>)
        <span class="hljs-keyword">is</span> Maybe.Just&lt;User&gt; -&gt; println(<span class="hljs-string">"<span class="hljs-subst">${rec.t.age}</span> years old"</span>)
    }
}</code></pre>
<p>Here, we define a simple class with a single immutable property (age), and a couple of functions. We have a lookupFromDB function that returns a Maybe: in this case, always a None, but that&rsquo;s just an example.</p>
<p>Then we use <a href="http://kotlinlang.org/docs/reference/control-flow.html#when-expression">the when expression</a> to do a pattern match on the type. When expressions are pretty flexible. They can use arbitrary expressions on the left hand side of each case and if the expression is a type query, the code on the right has the cast applied automatically. That&rsquo;s why we can just access the t property of rec immediately.</p>
<h3>Immutability</h3>
<p>Kotlin is not a pure FP language and does not have a &lsquo;default&rsquo; for mutable vs immutable. It gently encourages immutability in a few places by choice of syntax, but otherwise makes you choose each and every time.</p>
<p>Here&rsquo;s some code:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>(<span class="hljs-keyword">var</span> name: String, <span class="hljs-keyword">var</span> age: <span class="hljs-built_in">Int</span>)
<span class="hljs-keyword">val</span> p = Person(<span class="hljs-string">"Mike"</span>, <span class="hljs-number">31</span>)
p.name = <span class="hljs-string">"Bob"</span></code></pre>
<p>Here &ldquo;p&rdquo; is an immutable <strong>val</strong>ue: it cannot be reassigned. It&rsquo;s like a final variable in Java, or a let expression in Haskell/F#. But then the contents of this structure are mutable <strong>var</strong>iables, so they can be reassigned later. The IDE highlights identifiers differently if they&rsquo;re mutable.</p>
<p>Here&rsquo;s how it looks like, fully immutable</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>)
<span class="hljs-keyword">val</span> mike = Person(<span class="hljs-string">"Mike"</span>, <span class="hljs-number">31</span>)
<span class="hljs-keyword">val</span> olderMike = mike.copy(age = <span class="hljs-number">32</span>)</code></pre>
<p>The copy method is auto generated whenever the data modifier is used. It has a named argument for every property, with the default value of that argument being whatever the current value is. Net result, you can use it to create a fresh object with tweaked fields.</p>
<p>Lists are immutable by default:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> people = listOf(mike, olderMike)
people.add(Person(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">50</span>))                     <span class="hljs-comment">// ERROR</span>

<span class="hljs-keyword">val</span> peopleDB = arrayListOf(mike, olderMike)
peopleDB.add(Person(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">50</span>))

<span class="hljs-keyword">val</span> view: List&lt;Person&gt; = peopleDB
<span class="hljs-keyword">val</span> snapshot = peopleDB.toList()</code></pre>
<p>The second line won&rsquo;t compile: listOf() returns an immutable list. The fourth line does because we specifically picked an array list (vs a linked list), which is mutable. We can, of course, cast away the mutability to create a read only view, or clone the list to create a snapshot of it.</p>
<p>Currently there&rsquo;s no dedicated list literal syntax. There might be in future, but for now, we must use functions.</p>
<h3>Mapping, filtering, reducing etc</h3>
<p>Kotlin has support for efficient lambdas, and extends the default JDK collections classes to support common functions from FP standard libraries. This can even be used on Java 6 and thus Android:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> nums = listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
<span class="hljs-keyword">val</span> r = nums.map { it * <span class="hljs-number">2</span> }.sum()       <span class="hljs-comment">// r == 20</span></code></pre>
<p>Here, the &ldquo;it&rdquo; identifier is a convenience: if a lambda has only one argument, it&rsquo;s called &ldquo;it&rdquo; automatically. We can specify an explicit name when &ldquo;it&rdquo; would get too confusing, like in nested lambdas.</p>
<p>Map is an <em>extension function</em>. Where Java programmers would define a FooUtils class with static methods to add functionality to Foo classes, Kotlin lets you extend the class with a (statically dispatched) method directly. And then it uses that to give Java platform types like Iterable <a href="http://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-iterable/index.html">new features</a>.</p>
<p>A more advanced example:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> strs = listOf(<span class="hljs-string">"fish"</span>, <span class="hljs-string">"tree"</span>, <span class="hljs-string">"dog"</span>, <span class="hljs-string">"tree"</span>, <span class="hljs-string">"fish"</span>, <span class="hljs-string">"fish"</span>)
<span class="hljs-keyword">val</span> freqs = strs.groupBy { it }.mapValues { it.value.size() }
println(freqs)     <span class="hljs-comment">// {fish=3, tree=2, dog=1}</span></code></pre>
<h3>Recursive functions</h3>
<p>Functional programmers like to express solutions to problems using recursion. This often needs an optimisation called <em>tail call optimisation</em> to work well. Kotlin supports this in certain circumstances.</p>
<p>Here&rsquo;s a simple example. A <em>fixpoint</em> of a mathematical function is an input that gives itself as an output. To find a fixpoint of cosine, you can keep feeding the output back as an input until things stabilise. Here&rsquo;s an example in an imperative fashion:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cosFixpoint</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Double</span> {
    <span class="hljs-keyword">var</span> x = <span class="hljs-number">1.0</span>
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">val</span> y = Math.cos(x)
        <span class="hljs-keyword">if</span> (x == y) <span class="hljs-keyword">return</span> y
        x = y
    }
}</code></pre>
<p>Pretty simple: starting at 1.0 we keep calling cos until cos(a) == a.</p>
<p>Here&rsquo;s the same written in a recursive manner:</p>
<pre><code class="hljs language-kotlin">tailrec <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cosFixpoint</span><span class="hljs-params">(x: <span class="hljs-type">Double</span> = <span class="hljs-number">1.0</span>)</span></span>: <span class="hljs-built_in">Double</span> {
    <span class="hljs-keyword">val</span> r = Math.cos(x)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (x == r) x <span class="hljs-keyword">else</span> cosFixpoint(r)
}</code></pre>
<p>It could also be a one liner (or two here, with big fonts):</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">import</span> java.lang.Math.cos

tailrec
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">f</span><span class="hljs-params">(x: <span class="hljs-type">Double</span> = <span class="hljs-number">1.0</span>)</span></span>: <span class="hljs-built_in">Double</span> = <span class="hljs-keyword">if</span> (x == cos(x)) x <span class="hljs-keyword">else</span> f(cos(x)))</code></pre>
<p>That version relies on the JIT compiler to notice that it can eliminate the duplicated call to Math.cos(x).</p>
<h3>Currying, partial application, composition</h3>
<p>These are features you&rsquo;ll find in F# and Haskell, though I never felt a need for them myself. Currying turns a function into a chain of functions. Partial application lets you &lsquo;fix&rsquo; certain parameters to a function, resulting in a new function.</p>
<p>Kotlin doesn&rsquo;t support these out of the box. But it&rsquo;s flexible enough that they can be added by <a href="https://github.com/MarioAriasC/funKTionale/wiki">a library called funKtionale</a>, in a natural manner:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">import</span> org.funktionale.currying.*

<span class="hljs-keyword">val</span> sum2ints = { x: <span class="hljs-built_in">Int</span>, y: <span class="hljs-built_in">Int</span> -&gt; x + y }
<span class="hljs-keyword">val</span> curried: (<span class="hljs-built_in">Int</span>) -&gt; (<span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Int</span> = sum2ints.curried()
assertEquals(curried(<span class="hljs-number">2</span>)(<span class="hljs-number">4</span>), <span class="hljs-number">6</span>)
<span class="hljs-keyword">val</span> add5 = curried(<span class="hljs-number">5</span>)
assertEquals(add5(<span class="hljs-number">7</span>), <span class="hljs-number">12</span>)</code></pre>
<p>... and ...</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">import</span> org.funktionale.partials.*

<span class="hljs-keyword">val</span> format = { prefix: String, x: String, postfix: String -&gt;
    <span class="hljs-string">"<span class="hljs-subst">${prefix}</span><span class="hljs-subst">${x}</span><span class="hljs-subst">${postfix}</span>"</span>
}

<span class="hljs-keyword">val</span> prefixAndBang = format(p3 = <span class="hljs-string">"!"</span>)

<span class="hljs-comment">// Passing just the first parameter will return a new function</span>
<span class="hljs-keyword">val</span> hello = prefixAndBang(p1 = <span class="hljs-string">"Hello, "</span>)

println(hello(<span class="hljs-string">"world"</span>))</code></pre>
<h3>Lazyness</h3>
<p>Kotlin is a strict/eager language, and this is how it should be. As far as I&rsquo;m aware, no other well known language uses lazy-by-default except Haskell.</p>
<p>However you can do lazy computations if you want to. Here&rsquo;s a dead simple real world example: avoiding the work of building a string if logging is disabled.</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> loggingEnabled = System.getProperty(<span class="hljs-string">"log"</span>) != <span class="hljs-literal">null</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">log</span><span class="hljs-params">(s: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Unit</span> = <span class="hljs-keyword">if</span> (loggingEnabled) println(s)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">log</span><span class="hljs-params">(ls: ()</span></span> -&gt; String): <span class="hljs-built_in">Unit</span> = <span class="hljs-keyword">if</span> (loggingEnabled) println(ls())</code></pre>
<p>The log function is overloaded: it can take an actual string, or a function that calculates a string:</p>
<pre><code class="hljs language-kotlin">log(<span class="hljs-string">"now!"</span>)
log { <span class="hljs-string">"calculate me later"</span> }</code></pre>
<p>Functional programming occasionally involves building infinite lists of things and operating on them in a lazy and possibly parallel manner. <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/stm/STMTokyoApr10.pdf">This is often seen as a key selling point for FP</a> (see slide 10).</p>
<p>Since version 8 Java can do this too, and therefore so can Kotlin. For example:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> ONE = BigInteger.ONE
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">primes</span><span class="hljs-params">(n: <span class="hljs-type">Long</span>)</span></span> =
        Stream.iterate(ONE) { it + ONE }.
        filter { it.isProbablePrime(<span class="hljs-number">16</span>) }.
        limit(n).
        toList()</code></pre>
<p>Java calls infinite lazy lists <em>streams.</em> Here, we build a list of all the positive BigIntegers. Then we select only the ones that are probably prime numbers with chance 2^16, according to the Miller-Rabin primality test. Then we take <em>n</em> of them and put them into a regular non-lazy list. This is classical functional programming.</p>
<p>How fast is this?</p>
<pre><code class="hljs language-kotlin">repeat(<span class="hljs-number">3</span>) {
    <span class="hljs-keyword">val</span> t = measureTimeMillis {
        primes(<span class="hljs-number">100000</span>)
    }
    println(<span class="hljs-string">"Took <span class="hljs-subst">$t</span> msec"</span>)
}</code></pre>
<p>On my laptop, after the first run when the JIT compiler has crunched, it takes about 1.5 seconds.</p>
<p>One nice thing about pipelines of pure functions is you can parallelise them. Let&rsquo;s do that now:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">primes</span><span class="hljs-params">(n: <span class="hljs-type">Long</span>)</span></span> =
        Stream.iterate(ONE) { it + ONE }.
        parallel().
        filter { it.isProbablePrime(<span class="hljs-number">16</span>) }.
        limit(n).
        toArray()</code></pre>
<p>We inserted a call to parallel() in our stream. This tells the JVM to run the rest of the pipeline in multiple threads. Rerunning the program shows that this improved performance 3x: it now only takes half a second. Not bad!</p>
<h3>STM</h3>
<p>Software transactional memory is a way to write concurrent code. It is well explained in <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/stm/beautiful.pdf">this paper by Simon Peyton-Jones</a>, one of the architects of Haskell.</p>
<p>Instead of using locks you write code like this:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">var</span> account1 = <span class="hljs-number">5</span>
<span class="hljs-keyword">var</span> account2 = <span class="hljs-number">0</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">transfer</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>)</span></span> {
    atomic {
        account1 -= amount
        account2 += amount
    }
}</code></pre>
<p>From the programmers perspective, anything that happens inside the atomic block takes effect all at once when the block is exited and there can be no race conditions inside it. But multiple threads can all be inside the atomic block at once, doing useful work. Pretty neat, right?</p>
<p>A simple implementation would be to have a giant global lock, but that&rsquo;d be very slow. So fancier implementations record every change made inside the block by threads running concurrently, and detect conflicts: if there is a conflict, the block is retried. Haskell has an implementation of such a thing.</p>
<p>Kotlin does not have language support for software transactional memory. However, this is not such a big deal because via the JVM it gets support using libraries like <a href="http://nbronson.github.io/scala-stm/quick_start.html">Scala STM</a> (see below), and even something better: <em>hardware</em> transactional memory. Yup.</p>
<p>Modern (very modern) Intel chips support a set of processor extensions called TSX. TSX allows code to create an atomic transaction at the hardware level. Changes to RAM are buffered up in cache lines and interference between threads is tracked by the CPU itself. If there was a conflict, the CPU aborts the transaction and expects the code to either try again or fall back to regular locking. If no thread bumped into you, your writes are flushed to RAM in one go at the end.</p>
<p>Starting with Java 8 Update 40, so-called &ldquo;RTM locking&rdquo; is enabled by default when the CPU supports it. This converts <em>every</em> Java synchronized block into a hardware level atomic transaction using TSX. That means you will have multiple threads running inside synchronized blocks at once. The JVM profiles the app to find blocks that experience frequent thread interference, where the CPU is wasting time due to constantly rolling back/retrying, and converts them back to using regular locks. As Kotlin runs on the JVM it gets this functionality for free.</p>
<p>This lets you write code in the &ldquo;one big lock&rdquo; style without suffering the performance downsides, as long as you are on sufficiently new hardware.</p>
<p>I should note here that STMs often provide extra features, like the ability to pause/retry a code block when the dependencies change, or the ability to explicitly cancel a transaction without retrying it (by throwing an exception). Hardware TM doesn&rsquo;t offer this, or rather the JVM doesn&rsquo;t surface the support at the moment. If you want more control, you must use a library and explicitly change your data model to incorporate transactional variables:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">import</span> scala.concurrent.stm.japi.STM.*

<span class="hljs-keyword">val</span> counter = newRef(<span class="hljs-number">10</span>)
<span class="hljs-keyword">try</span> {
    atomic {
        increment(counter, <span class="hljs-number">1</span>)
        println(<span class="hljs-string">"counter is <span class="hljs-subst">${counter.get()}</span>"</span>)    <span class="hljs-comment">// -&gt; 11</span>
        <span class="hljs-keyword">throw</span> Exception(<span class="hljs-string">"roll back!!"</span>)
    }
} <span class="hljs-keyword">catch</span>(e: Exception) {
    println(<span class="hljs-string">"counter is <span class="hljs-subst">${counter.get()}</span>"</span>)        <span class="hljs-comment">// -&gt; 10</span>
}</code></pre>
<p>Haskell has one other neat trick up its sleeve &mdash;using its type system it can ensure that variables are only accessed inside atomic blocks, so you can never forget to wrap your code up properly. We can do something a bit similar in Kotlin:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadBox</span>&lt;<span class="hljs-type">T</span>&gt;</span>(v: T) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> value = v
    <span class="hljs-meta">@Synchronized</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> locked<span class="hljs-type">&lt;R&gt;</span><span class="hljs-params">(f: <span class="hljs-type">T</span>.()</span></span> -&gt; R): R = value.f()
}

<span class="hljs-keyword">val</span> bank = ThreadBox(<span class="hljs-keyword">object</span> {
    <span class="hljs-keyword">val</span> accounts = intArrayOf(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
})

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">transfer</span><span class="hljs-params">(from: <span class="hljs-type">Int</span>, to: <span class="hljs-type">Int</span>, amount: <span class="hljs-type">Int</span>)</span></span> {
    bank.locked {
        accounts[from] -= amount
        accounts[to] += amount
    }
}</code></pre>
<p>A ThreadBox is a simple class that takes a pointer to some object in its constructor. It keeps that pointer privately. So, if there&rsquo;s no other reference to the passed object it can only be accessed via the ThreadBox. When we declare <em>bank</em>, we use the object keyword to create an anonymous object and pass it in&#x200A;&mdash;&#x200A;so we know the only way to reach the accounts array is via the ThreadBox. And the ThreadBox only gives out that pointer inside an atomic block.</p>
<p>The compiler won&rsquo;t let us access the array outside an atomic block ... unless we let a reference escape. So this is not as strong as the Haskell type system approach, but it&rsquo;s a good start.</p>
<p>There&rsquo;s a version of this code that can catch more mistakes <a href="https://gist.github.com/mikehearn/1ad4a9c375e59e52b8cf">here</a>.</p>
<p>The atomic method is a higher order function protected by a regular Java synchronized method, and it just immediately calls the provided code block under the lock. The JVM will ignore the lock on hardware that supports TSX and all threads can proceed in parallel, in an atomic transaction. As long as the two threads are using different account IDs for <em>from</em> and <em>to</em>, no locking is done at all: that makes it nice and fast.</p>
<h3>Things Kotlin lacks</h3>
<p>At the moment there is no way to control side effects: any function call can be potentially side effecting. It would be nice if a future version of the language introduced something like the C++ const keyword, or D&rsquo;s transitive const, to reduce the reliance on actually immutable data structures. The JVM offers features that can seal off common sources of external state, such as the disk and network, however the heap is still available. It may be an interesting project to make the JVM&rsquo;s sandboxing features easily available via a Kotlin DSL.</p>
<p>There is not at this moment any high performance immutable collections library. Both Clojure and Scala have maps and sets in which mutating the collection returns a new collection, with internal data sharing to make performance practical. The Kotlin standard library does not. If someone were to make one, using <a href="http://michael.steindorfer.name/publications/oopsla15.pdf">the CHAMP code</a> published this year would give significant improvements over the algorithms used in Scala/Clojure.</p>

      
      <div class="main-content-backlink">
        <hr/>
        <a href='http://kotlin.link/'>&larr; Back to kotlin.link</a>
      </div>
    </div>
  </section>

  <script>
    var menuLink = document.querySelector('.menu-link');

    var listener = function() {
      this.class = 'active';
      this.layout = document.getElementById('layout');
      this.handleEvent = function() {
        this.layout.classList.toggle(this.class);
      };
      this.handleEvent();
    };

    menuLink.addEventListener("click", function(){listener();}, false);
  </script>

  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/github.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
  <!-- Yandex.Metrika counter -->
  <script type="text/javascript">
    (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
        try {
          w.yaCounter35722810 = new Ya.Metrika({id:35722810,
            webvisor:true,
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true});
        } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
  </script>
  <noscript><div><img src="//mc.yandex.ru/watch/35722810" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
  <!-- /Yandex.Metrika counter -->
</body>
</html>
